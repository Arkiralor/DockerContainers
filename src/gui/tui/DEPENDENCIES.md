# Dependency Management

This project uses multiple methods for dependency management:

## Main Dependencies (Runtime)

### Using pip-compile (Recommended for pinning)

The `requirements.in` file contains the direct runtime dependencies:

```
textual>=0.50.0
docker>=7.0.0
click>=8.1.0
pyyaml>=6.0.1
rich>=13.7.0
```

To regenerate `requirements.txt` with pinned versions:

```bash
# Install pip-tools
pip install pip-tools

# Compile requirements
pip-compile requirements.in

# Install from compiled requirements
pip install -r requirements.txt
```

### Using pyproject.toml

The same runtime dependencies are defined in `pyproject.toml`:

```bash
# Install from pyproject.toml
pip install -e .
```

## Development Dependencies

Development and testing dependencies are defined in `pyproject.toml` as optional dependencies:

### Test Dependencies

```bash
# Install with test dependencies
pip install -e ".[test]"
```

Includes:
- pytest>=9.0.2
- pytest-mock>=3.11.1
- pytest-cov>=4.1.0
- pytest-xdist>=3.3.1
- pytest-asyncio>=0.21.1

### Dev Dependencies

```bash
# Install with full development dependencies
pip install -e ".[dev]"
```

Includes all test dependencies plus:
- black>=24.4.0
- ruff>=0.1.0
- mypy>=1.7.0

## Dependency Versions

### Current Versions

As of February 2024:

| Package | Minimum Version | Latest Tested |
|---------|----------------|---------------|
| textual | 0.50.0 | 7.5.0 |
| docker | 7.0.0 | 7.1.0 |
| click | 8.1.0 | 8.3.1 |
| pyyaml | 6.0.1 | 6.0.3 |
| rich | 13.7.0 | 14.3.2 |
| pytest | 9.0.2 | 9.0.2 |

## Updating Dependencies

### Update All Dependencies

```bash
# Update requirements.txt
pip-compile --upgrade requirements.in

# Update dev dependencies (manual edit of pyproject.toml)
```

### Update Specific Package

```bash
# Update textual only
pip-compile --upgrade-package textual requirements.in
```

### Check for Outdated Packages

```bash
pip list --outdated
```

## Best Practices

1. **Runtime Dependencies**: Keep in both `requirements.in` and `pyproject.toml` for flexibility
2. **Dev/Test Dependencies**: Only in `pyproject.toml` optional dependencies
3. **Version Pinning**: Use `requirements.txt` for reproducible builds
4. **Version Ranges**: Use `requirements.in` and `pyproject.toml` for acceptable versions

## Installation Methods Comparison

| Method | Use Case | Dependencies |
|--------|----------|--------------|
| `pip install -r requirements.txt` | Production/CI | Pinned runtime only |
| `pip install -e .` | Basic development | Unpinned runtime only |
| `pip install -e ".[test]"` | Testing | Runtime + test tools |
| `pip install -e ".[dev]"` | Full development | Runtime + test + dev tools |

## Troubleshooting

### Dependency Conflicts

If you encounter conflicts:

```bash
# Clear pip cache
pip cache purge

# Create fresh virtual environment
python -m venv venv
source venv/bin/activate  # or `venv\Scripts\activate` on Windows

# Install fresh
pip install -e ".[dev]"
```

### Regenerating requirements.txt

After updating `requirements.in`:

```bash
pip-compile requirements.in --output-file requirements.txt
```

### Checking Dependency Tree

```bash
# Install pipdeptree
pip install pipdeptree

# View dependency tree
pipdeptree
```

## Notes

- `requirements.txt` is auto-generated by pip-compile - do not edit manually
- `requirements.in` contains only direct runtime dependencies
- `pyproject.toml` is the source of truth for the project metadata
- pytest is intentionally NOT in requirements.in (it's a dev dependency)
